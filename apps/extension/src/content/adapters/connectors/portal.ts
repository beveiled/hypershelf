import type { ConnectorAdapter } from "../types";
import { textFromSelector } from "../utils";
import { PopoverWidget } from "../widgets";

export const portalConnector = {
  id: "portal",
  widget: PopoverWidget,
  banner:
    "data:image/svg+xml;base64,PHN2ZyBpZD0iYSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMzE2IDcxIj4KICA8cmVjdCB3aWR0aD0iMzE2IiBoZWlnaHQ9IjcxIiByeD0iOCIgcnk9IjgiIGZpbGw9IiMwOTA5MGEiLz4KICA8bGluZSB4MT0iMTYuNTkiIHkxPSIyNC4yNSIgeDI9IjMxLjA3IiB5Mj0iMjQuMjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzljZTgyNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8ZyBpc29sYXRpb249Imlzb2xhdGUiPgogICAgPGcgaXNvbGF0aW9uPSJpc29sYXRlIj4KICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTkgNTMpIiBmaWxsPSIjZmZmIiBmb250LWZhbWlseT0iQ2hpY2twZWFzLCBDaGlja3BlYXMiIGZvbnQtc2l6ZT0iMjIiIGlzb2xhdGlvbj0iaXNvbGF0ZSI+PHRzcGFuIHg9IjAiIHk9IjAiPkJvbzwvdHNwYW4+PC90ZXh0PgogICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1MS4xNiA1MykiIGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJDaGlja3BlYXMsIENoaWNrcGVhcyIgZm9udC1zaXplPSIyMiIgaXNvbGF0aW9uPSJpc29sYXRlIj48dHNwYW4geD0iMCIgeT0iMCI+dDwvdHNwYW4+PC90ZXh0PgogICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1OS45NiA1MykiIGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJDaGlja3BlYXMsIENoaWNrcGVhcyIgZm9udC1zaXplPSIyMiIgaXNvbGF0aW9uPSJpc29sYXRlIj48dHNwYW4geD0iMCIgeT0iMCI+aW5nIHVwIHRoZSBpbnRlZ3I8L3RzcGFuPjwvdGV4dD4KICAgICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI3LjUzIDUzKSIgZmlsbD0iI2ZmZiIgZm9udC1mYW1pbHk9IkNoaWNrcGVhcywgQ2hpY2twZWFzIiBmb250LXNpemU9IjIyIiBpc29sYXRpb249Imlzb2xhdGUiPjx0c3BhbiB4PSIwIiB5PSIwIj5hPC90c3Bhbj48L3RleHQ+CiAgICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzNS44MyA1MykiIGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJDaGlja3BlYXMsIENoaWNrcGVhcyIgZm9udC1zaXplPSIyMiIgaXNvbGF0aW9uPSJpc29sYXRlIj48dHNwYW4geD0iMCIgeT0iMCI+dDwvdHNwYW4+PC90ZXh0PgogICAgICA8dGV4dCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDQuNjMgNTMpIiBmaWxsPSIjZmZmIiBmb250LWZhbWlseT0iQ2hpY2twZWFzLCBDaGlja3BlYXMiIGZvbnQtc2l6ZT0iMjIiIGlzb2xhdGlvbj0iaXNvbGF0ZSI+PHRzcGFuIHg9IjAiIHk9IjAiPmlvbi4uLjwvdHNwYW4+PC90ZXh0PgogICAgPC9nPgogIDwvZz4KICA8ZyBpc29sYXRpb249Imlzb2xhdGUiPgogICAgPHRleHQgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYgMjEuOSkiIGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJTeW5lLUV4dHJhQm9sZCwgU3luZSIgZm9udC1zaXplPSIxMiIgZm9udC12YXJpYXRpb24tc2V0dGluZ3M9IiZhcG9zO3dnaHQmYXBvczsgODAwIiBmb250LXdlaWdodD0iNzAwIiBpc29sYXRpb249Imlzb2xhdGUiPjx0c3BhbiB4PSIwIiB5PSIwIj5IeXBlcnNoZTwvdHNwYW4+PHRzcGFuIHg9IjkyLjA5IiB5PSIwIiBsZXR0ZXItc3BhY2luZz0iLS4wMmVtIj5sPC90c3Bhbj48dHNwYW4geD0iOTYuMTciIHk9IjAiPmY8L3RzcGFuPjwvdGV4dD4KICA8L2c+CiAgPGcgaXNvbGF0aW9uPSJpc29sYXRlIj4KICAgIDx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0MCAyMi44OCkiIGZpbGw9IiNmZmYiIGZvbnQtZmFtaWx5PSJDaGlja3BlYXMsIENoaWNrcGVhcyIgZm9udC1zaXplPSIyMiIgaXNvbGF0aW9uPSJpc29sYXRlIj48dHNwYW4geD0iMCIgeT0iMCI+eDwvdHNwYW4+PC90ZXh0PgogIDwvZz4KICA8ZyBpZD0iYiIgZGF0YS1uYW1lPSJzdGFuZG9mZjM2NS13aGl0ZS0yMHB4Ij4KICAgIDxnIGlkPSJjIiBkYXRhLW5hbWU9Ikdyb3VwIDU2MCI+CiAgICAgIDxwYXRoIGlkPSJkIiBkYXRhLW5hbWU9IlZlY3RvciA1IiBkPSJNMTk5Ljk3LDEyLjY2bC00LjMzLDkuNzhoMy43bC43My0xLjY0aDQuNzhsLjczLDEuNjRoMy43MmwtNC4zMy05Ljc4aC00Ljk5Wk0yMDEuMjEsMTcuOTZsMS4yNS0yLjU2LDEuMjUsMi41NmgtMi40OVoiIGZpbGw9IiNmZmYiLz4KICAgICAgPHBhdGggaWQ9ImUiIGRhdGEtbmFtZT0iVmVjdG9yIDYiIGQ9Ik0yMzAuMywxMi42NmgtNi42MXY5Ljc4aDYuNjRjMi40OSwwLDUuNDYtMS4xMSw1LjQ2LTQuODksMC00LjE4LTIuNjktNC44OS01LjQ5LTQuODlaTTIzMC4xMSwxOS43N2gtMi43MnYtNC40M2gyLjcyYzEuNzIsMCwyLjMzLjk5LDIuMzMsMi4yMnMtLjc3LDIuMjItMi4zMywyLjIyWiIgZmlsbD0iI2ZmZiIvPgogICAgICA8cGF0aCBpZD0iZiIgZGF0YS1uYW1lPSJWZWN0b3IgNyIgZD0iTTI0My4xMiwxMi40OGMtNC4zMywwLTYuNDIsMS41NC02LjQyLDQuODIsMCwzLjUxLDEuOSw1LjE4LDYuNSw1LjE4czYuNjItMS4xOSw2LjYyLTUtMi41Mi01LTYuNzEtNVpNMjQzLjI0LDE5LjkxYy0yLjA2LDAtMy4wMS0xLjAxLTMuMDEtMi40MywwLTEuNTMuOTUtMi40MywyLjk2LTIuNDMsMS44MSwwLDMuMS44LDMuMSwyLjQzcy0xLjE4LDIuNDMtMy4wNiwyLjQzWiIgZmlsbD0iI2ZmZiIvPgogICAgICA8cGF0aCBpZD0iZyIgZGF0YS1uYW1lPSJWZWN0b3IgOCIgZD0iTTI2MS41LDE1LjYxdi0yLjk5aDkuNTd2OS44MmgtNC4wMnYtM2gtNS41NXYtMi44N2g1LjU1di0uOTVoLTUuNTVaIiBmaWxsPSIjZmZmIi8+CiAgICAgIDxwYXRoIGlkPSJoIiBkYXRhLW5hbWU9IlZlY3RvciA5IiBkPSJNMTk3LjM0LDE1Ljl2LTMuMjhoLTEyLjc2djMuMjhoNC41M3Y2LjUzaDMuN3YtNi41M2g0LjUzWiIgZmlsbD0iI2ZmZiIvPgogICAgICA8cGF0aCBpZD0iaSIgZGF0YS1uYW1lPSJWZWN0b3IgMTAiIGQ9Ik0yMTguNjUsMTcuODFsLTQuMTYtNS4xOWgtNC40NnY5LjgxaDMuN3YtNS4yOWw0LjI0LDUuMjloNC4zOHYtOS44MWgwcy0zLjcsMC0zLjcsMHY1LjE5WiIgZmlsbD0iI2ZmZiIvPgogICAgICA8cGF0aCBpZD0iaiIgZGF0YS1uYW1lPSJWZWN0b3IgMTEiIGQ9Ik0yNTQuOCwxNS42MWg1LjU1di0yLjk5aC05LjU3djkuODJoNC4wMnYtM2g1LjU1di0yLjg3aC01LjU1di0uOTVaIiBmaWxsPSIjZmZmIi8+CiAgICAgIDxwYXRoIGlkPSJrIiBkYXRhLW5hbWU9IlZlY3RvciAxMiIgZD0iTTE3Ny43NywyMi40MWMyLjQsMCwzLjk4LS4wOCw1LS41MiwxLjA0LS40NCwxLjQ4LTEuMjYsMS40OC0yLjcxLDAtLjYtLjEzLTEuMDktLjM5LTEuNDgtLjA5LS4xMy0uMjUtLjI5LS4yOS0uMzItLjI4LS4yMy0uNjYtLjM5LTEuMTktLjUzLS4wMSwwLTEuMDgtLjMtMi44OS0uNDUtLjA5LDAtLjItLjAyLS4zMi0uMDMtLjMzLS4wMy0uNzktLjA3LTEuNDEtLjExLS40MS0uMDMtLjc2LS4wNC0xLjA3LS4wNi0uMjktLjAxLS41NC0uMDItLjc1LS4wNC0uMDUsMC0uMTEsMC0uMTctLjAxLS42NS0uMDUtMS4yOS0uMTItMS4zLS4zNS0uMDEtLjE5LjE3LS4zNy42My0uNDMuNDctLjA2LjY5LS4wOCwxLjMtLjA4LjY4LDAsMi40LjA4LDIuOC4xNS4yLjA0LjM0LjA4LjQ4LjE2LjEzLjA3LjIyLjE3LjI3LjI3aDMuOTR2LS4xNGMtLjExLTIuNjEtMS41OC0zLjI1LTYuODEtMy4yNS0yLjQsMC0zLjk4LjA4LTUsLjUyLTEuMDQuNDQtMS40OCwxLjI2LTEuNDgsMi43MSwwLC43NC4xOSwxLjMuNTcsMS43MS4yOC4yNy42Ny40NiwxLjMuNjIuMDEsMCwxLjA4LjI1LDIuODkuNC4wOSwwLC4yLjAyLjMyLjAzLjMzLjAzLjc5LjA3LDEuNDEuMTEuNDEuMDMuNzYuMDQsMS4wNy4wNS4yOS4wMS41NS4wMi43NS4wNC4wNSwwLC4xLDAsLjE3LjAxLjY2LjA1LDEuMy4xMiwxLjMxLjM3LDAsLjE5LS4xLjQtLjY0LjQ3LS40Ny4wNi0uNjkuMDgtMS4zLjA4LS43MSwwLTIuNTctLjA2LTMuMDEtLjE1LS4yMS0uMDUtLjM3LS4xLS40OS0uMTctLjEyLS4wNy0uMjEtLjE2LS4yNi0uMjdoLTMuOTR2LjExaDB2LjAyYy4xMiwyLjU4LDEuNjksMy4yMyw3LjAyLDMuMjNaIiBmaWxsPSIjZmZmIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4=",
  anchorSelectors: [
    'div[data-testid="reportHostInfoHosts"]',
    'div[data-testid="reportHostInfoAddressNotResolved"]',
  ],
  anchorPosition: "end",
  observableSelectors: [
    'div[data-testid="reportHostInfoHosts"]',
    'div[data-testid="reportHostInfoAddressNotResolved"]',
  ],
  extractHostname: (ctx) => {
    const outOfScope = textFromSelector(
      ctx.doc,
      'div[data-testid="reportHostInfoAddressNotResolved"]',
    );
    if (outOfScope) return outOfScope;
    return textFromSelector(
      ctx.doc,
      'div[data-testid="reportHostInfoHosts"] .inline:nth-child(3) span',
    );
  },
  mountStyles: {
    display: "inline-block",
    marginLeft: "0.75rem",
    verticalAlign: "middle",
  },
} as const satisfies ConnectorAdapter;
